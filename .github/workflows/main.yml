name: Deploy Laravel via SFTP

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install lftp
        run: sudo apt-get update && sudo apt-get install -y lftp

      - name: Deploy via SFTP using lftp
        env:
          SFTP_HOST: ${{ secrets.SFTP_HOST }}
          SFTP_USER: ${{ secrets.SFTP_USER }}
          SFTP_PASSWORD: ${{ secrets.SFTP_PASSWORD }}
          REMOTE_PATH: "/var/www/travel-demo/"
        run: |
          echo "ðŸ”„ Deploying project to $SFTP_HOST via lftp..."
          lftp -u "$SFTP_USER","$SFTP_PASSWORD" sftp://$SFTP_HOST <<EOF
          mirror -R ./ $REMOTE_PATH --delete --verbose --exclude .git --exclude node_modules --exclude vendor
          quit
          EOF
